meta {
  name: Get User Profile Completion
  type: http
  seq: 13
}

get {
  url: {{GATEWAY_URL}}/api/users/{{username}}/profile-complete
  body: none
  auth: bearer
}

params:path {
  username: {{USERNAME}}
}

auth:bearer {
  token: {{ACCESS_TOKEN}}
}

headers {
  X-Username: {{USERNAME}}
}

script:post-response {
  let body = {};
  const raw = res.body;
  if (typeof raw === 'string') {
    const trimmed = raw.trim();
    if (trimmed.length > 0) {
      try { body = JSON.parse(trimmed); } catch (e) {
        console.warn('âš ï¸ Response is not valid JSON; showing raw text');
        body = { raw: trimmed };
      }
    }
  } else if (raw != null) {
    body = raw;
  }

  if (res.status === 200 && typeof body.complete !== 'undefined') {
    console.log(`âœ… Profile completeness check successful`);
    console.log(`ğŸ‘¤ Username: ${body.username}`);
    console.log(`ğŸ“‹ Profile complete: ${body.complete ? 'âœ… Yes' : 'âŒ No'}`);
  } else if (res.status === 404) {
    console.error('âŒ User not found');
  } else if (res.status === 400) {
    console.error('âŒ Bad request');
  } else {
    const shown = typeof raw === 'string' ? raw : JSON.stringify(raw);
    console.error(`âŒ Unexpected status: ${res.status}`);
    console.error(`Response: ${shown}`);
  }
}
